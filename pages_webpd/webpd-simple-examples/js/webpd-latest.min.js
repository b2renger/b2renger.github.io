!function(){"use strict";function a(a){a&&(a.setTargetAtTime||(a.setTargetAtTime=a.setTargetValueAtTime))}window.hasOwnProperty("webkitAudioContext")&&!window.hasOwnProperty("AudioContext")&&(window.AudioContext=webkitAudioContext,AudioContext.prototype.hasOwnProperty("createGain")||(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),AudioContext.prototype.hasOwnProperty("createDelay")||(AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode),AudioContext.prototype.hasOwnProperty("createScriptProcessor")||(AudioContext.prototype.createScriptProcessor=AudioContext.prototype.createJavaScriptNode),AudioContext.prototype.hasOwnProperty("createPeriodicWave")||(AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable),AudioContext.prototype.internal_createGain=AudioContext.prototype.createGain,AudioContext.prototype.createGain=function(){var b=this.internal_createGain();return a(b.gain),b},AudioContext.prototype.internal_createDelay=AudioContext.prototype.createDelay,AudioContext.prototype.createDelay=function(b){var c=b?this.internal_createDelay(b):this.internal_createDelay();return a(c.delayTime),c},AudioContext.prototype.internal_createBufferSource=AudioContext.prototype.createBufferSource,AudioContext.prototype.createBufferSource=function(){var b=this.internal_createBufferSource();return b.start||(b.start=function(a,b,c){b||c?this.noteGrainOn(a,b,c):this.noteOn(a)}),b.stop||(b.stop=b.noteOff),a(b.playbackRate),b},AudioContext.prototype.internal_createDynamicsCompressor=AudioContext.prototype.createDynamicsCompressor,AudioContext.prototype.createDynamicsCompressor=function(){var b=this.internal_createDynamicsCompressor();return a(b.threshold),a(b.knee),a(b.ratio),a(b.reduction),a(b.attack),a(b.release),b},AudioContext.prototype.internal_createBiquadFilter=AudioContext.prototype.createBiquadFilter,AudioContext.prototype.createBiquadFilter=function(){var b=this.internal_createBiquadFilter();return a(b.frequency),a(b.detune),a(b.Q),a(b.gain),b},AudioContext.prototype.hasOwnProperty("createOscillator")&&(AudioContext.prototype.internal_createOscillator=AudioContext.prototype.createOscillator,AudioContext.prototype.createOscillator=function(){var b=this.internal_createOscillator();return b.start||(b.start=b.noteOn),b.stop||(b.stop=b.noteOff),b.setPeriodicWave||(b.setPeriodicWave=b.setWaveTable),a(b.frequency),a(b.detune),b}))}(window),!function(a){function b(){this._events=new Object}function c(a){a&&(a.delimiter&&(this.delimiter=a.delimiter),a.maxListeners&&(this._events.maxListeners=a.maxListeners),a.wildcard&&(this.wildcard=a.wildcard),this.wildcard&&(this.listenerTree=new Object))}function d(a){this._events=new Object,c.call(this,a)}function e(a,b,c,d){if(!c)return[];var f,g,h,i,j,k,l,m=[],n=b.length,o=b[d],p=b[d+1];if(d===n&&c._listeners){if("function"==typeof c._listeners)return a&&a.push(c._listeners),[c];for(f=0,g=c._listeners.length;g>f;f++)a&&a.push(c._listeners[f]);return[c]}if("*"===o||"**"===o||c[o]){if("*"===o){for(h in c)"_listeners"!==h&&c.hasOwnProperty(h)&&(m=m.concat(e(a,b,c[h],d+1)));return m}if("**"===o){l=d+1===n||d+2===n&&"*"===p,l&&c._listeners&&(m=m.concat(e(a,b,c,n)));for(h in c)"_listeners"!==h&&c.hasOwnProperty(h)&&("*"===h||"**"===h?(c[h]._listeners&&!l&&(m=m.concat(e(a,b,c[h],n))),m=m.concat(e(a,b,c[h],d))):m=m.concat(h===p?e(a,b,c[h],d+2):e(a,b,c[h],d)));return m}m=m.concat(e(a,b,c[o],d+1))}if(i=c["*"],i&&e(a,b,i,d+1),j=c["**"])if(n>d){j._listeners&&e(a,b,j,n);for(h in j)"_listeners"!==h&&j.hasOwnProperty(h)&&(h===p?e(a,b,j[h],d+2):h===o?e(a,b,j[h],d+1):(k={},k[h]=j[h],e(a,b,{"**":k},d+1)))}else j._listeners?e(a,b,j,n):j["*"]&&j["*"]._listeners&&e(a,b,j["*"],n);return m}function f(a,b){a="string"==typeof a?a.split(this.delimiter):a.slice();for(var c=0,d=a.length;d>c+1;c++)if("**"===a[c]&&"**"===a[c+1])return;for(var e=this.listenerTree,f=a.shift();f;){if(e[f]||(e[f]=new Object),e=e[f],0===a.length){if(e._listeners){if("function"==typeof e._listeners)e._listeners=[e._listeners,b];else if(g(e._listeners)&&(e._listeners.push(b),!e._listeners.warned)){var i=h;"undefined"!=typeof this._events.maxListeners&&(i=this._events.maxListeners),i>0&&e._listeners.length>i&&(e._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",e._listeners.length),console.trace())}}else e._listeners=b;return!0}f=a.shift()}return!0}var g=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},h=10;d.prototype.delimiter=".",d.prototype.setMaxListeners=function(a){this._events||b.call(this),this._events.maxListeners=a},d.prototype.event="",d.prototype.once=function(a,b){return this.many(a,1,b),this},d.prototype.many=function(a,b,c){function d(){0===--b&&e.off(a,d),c.apply(this,arguments)}var e=this;if("function"!=typeof c)throw new Error("many only accepts instances of Function");return d._origin=c,this.on(a,d),e},d.prototype.emit=function(){this._events||b.call(this);var a=arguments[0];if("newListener"===a&&!this._events.newListener)return!1;if(this._all){for(var c=arguments.length,d=new Array(c-1),f=1;c>f;f++)d[f-1]=arguments[f];for(f=0,c=this._all.length;c>f;f++)this.event=a,this._all[f].apply(this,d)}if("error"===a&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");var g;if(this.wildcard){g=[];var h="string"==typeof a?a.split(this.delimiter):a.slice();e.call(this,g,h,this.listenerTree,0)}else g=this._events[a];if("function"==typeof g){if(this.event=a,1===arguments.length)g.call(this);else if(arguments.length>1)switch(arguments.length){case 2:g.call(this,arguments[1]);break;case 3:g.call(this,arguments[1],arguments[2]);break;default:for(var c=arguments.length,d=new Array(c-1),f=1;c>f;f++)d[f-1]=arguments[f];g.apply(this,d)}return!0}if(g){for(var c=arguments.length,d=new Array(c-1),f=1;c>f;f++)d[f-1]=arguments[f];for(var i=g.slice(),f=0,c=i.length;c>f;f++)this.event=a,i[f].apply(this,d);return i.length>0||this._all}return this._all},d.prototype.on=function(a,c){if("function"==typeof a)return this.onAny(a),this;if("function"!=typeof c)throw new Error("on only accepts instances of Function");if(this._events||b.call(this),this.emit("newListener",a,c),this.wildcard)return f.call(this,a,c),this;if(this._events[a]){if("function"==typeof this._events[a])this._events[a]=[this._events[a],c];else if(g(this._events[a])&&(this._events[a].push(c),!this._events[a].warned)){var d=h;"undefined"!=typeof this._events.maxListeners&&(d=this._events.maxListeners),d>0&&this._events[a].length>d&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),console.trace())}}else this._events[a]=c;return this},d.prototype.onAny=function(a){if(this._all||(this._all=[]),"function"!=typeof a)throw new Error("onAny only accepts instances of Function");return this._all.push(a),this},d.prototype.addListener=d.prototype.on,d.prototype.off=function(a,b){if("function"!=typeof b)throw new Error("removeListener only takes instances of Function");var c,d=[];if(this.wildcard){var f="string"==typeof a?a.split(this.delimiter):a.slice();d=e.call(this,null,f,this.listenerTree,0)}else{if(!this._events[a])return this;c=this._events[a],d.push({_listeners:c})}for(var h=0;h<d.length;h++){var i=d[h];if(c=i._listeners,g(c)){for(var j=-1,k=0,l=c.length;l>k;k++)if(c[k]===b||c[k].listener&&c[k].listener===b||c[k]._origin&&c[k]._origin===b){j=k;break}if(0>j)return this;this.wildcard?i._listeners.splice(j,1):this._events[a].splice(j,1),0===c.length&&(this.wildcard?delete i._listeners:delete this._events[a])}else(c===b||c.listener&&c.listener===b||c._origin&&c._origin===b)&&(this.wildcard?delete i._listeners:delete this._events[a])}return this},d.prototype.offAny=function(a){var b,c=0,d=0;if(a&&this._all&&this._all.length>0){for(b=this._all,c=0,d=b.length;d>c;c++)if(a===b[c])return b.splice(c,1),this}else this._all=[];return this},d.prototype.removeListener=d.prototype.off,d.prototype.removeAllListeners=function(a){if(0===arguments.length)return!this._events||b.call(this),this;if(this.wildcard)for(var c="string"==typeof a?a.split(this.delimiter):a.slice(),d=e.call(this,null,c,this.listenerTree,0),f=0;f<d.length;f++){var g=d[f];g._listeners=null}else{if(!this._events[a])return this;this._events[a]=null}return this},d.prototype.listeners=function(a){if(this.wildcard){var c=[],d="string"==typeof a?a.split(this.delimiter):a.slice();return e.call(this,c,d,this.listenerTree,0),c}return this._events||b.call(this),this._events[a]||(this._events[a]=[]),g(this._events[a])||(this._events[a]=[this._events[a]]),this._events[a]},d.prototype.listenersAny=function(){return this._all?this._all:[]},a.EventEmitter2=d}(window),function(){this.EventEmitter=EventEmitter2;var a=this.Pd={sampleRate:44100,blockSize:1024,channelCount:2,debugMode:!1,arrayType:Array,arraySlice:function(a,b,c){return a.slice(b,c)}};"undefined"!=typeof Float32Array&&(a.arrayType=Float32Array,a.arraySlice=function(a,b,c){return a.subarray(b,c)}),a.isSupported=function(){var a="undefined"==typeof window?null:window.webkitAudioContext||window.AudioContext;return a?!0:!1},a.register=function(b){if("abstract"!==b.type)if(b instanceof a.Patch)-1===this._patches.indexOf(b)&&(this._patches.push(b),b.id=this._generateId());else if(b instanceof a.NamedObject){var c=function(c,d){var e,f=b.type,g=a._namedObjects[b.type];g||(g=a._namedObjects[f]={}),e=g[d],e||(e=g[d]=[]),-1===e.indexOf(b)&&e.push(b),c&&(e=g[c],e.splice(e.indexOf(b),1))};b.on("change:name",c),c(null,b.name)}else if(b instanceof a.UniquelyNamedObject){var c=function(c,d){var e=b.type,f=a._uniquelyNamedObjects[b.type];if(f||(f=a._uniquelyNamedObjects[e]={}),f.hasOwnProperty(d)&&f[d]!==b)throw new Error('there is already an object with name "'+d+'"');f[d]=b,c&&(f[c]=void 0)};b.on("change:name",c),c(null,b.name)}},a._patches=[],a._namedObjects={},a._uniquelyNamedObjects={},a.getNamedObject=function(a,b){return(this._namedObjects[a]||{})[b]||[]},a.getUniquelyNamedObject=function(a,b){return(this._uniquelyNamedObjects[a]||{})[b]||null},a.isArray=Array.isArray||function(a){return"[object Array]"===toString.call(a)},a.isNumber=function(a){return"number"==typeof a&&!isNaN(a)},a.isString=function(a){return"string"==typeof a},a.isFunction=function(a){return"function"==typeof a},a.extend=function(a){var b,c,d,e,f=Array.prototype.slice.call(arguments,1);for(b=0,c=f.length;c>b;b++){d=f[b];for(e in d)a[e]=d[e]}return a},a.chainExtend=function(){var b=Array.prototype.slice.call(arguments,0),c=this,d=function(){c.apply(this,arguments)};return d.prototype=new c,a.extend.apply(this,[d.prototype,c.prototype].concat(b)),d.extend=this.extend,d},a.UniqueIdsBase={_generateId:function(){return this._idCounter++,this._idCounter},_idCounter:-1},a.extend(a,a.UniqueIdsBase),a.makeMsgTransfer=function(a){var d,e,f,g,h,i=[];for(a=a.slice(0),d=0,e=a.length;e>d;d++)f=a[d],g=b.exec(f),i.push(g&&g[0]===f?function(){var a=parseInt(g[1],10)-1;return function(b){if(a>=b.length||0>a)throw new Error("$"+(a+1)+": argument number out of range");return b[a]}}(f):g?function(a){for(var b,d,e,f=[];d=c.exec(a);)f.push([d[0],parseInt(d[1],10)-1]);return function(c){var g=a.substr(0);for(b=0;d=f[b];b++){if(e=d[1],e>=c.length||0>e)throw new Error("$"+(e+1)+": argument number out of range");g=g.replace(d[0],c[e])}return g}}(f):function(a){return function(){return a}}(f));return function(a){var b=[];for(d=0;h=i[d];d++)b[d]=h(a);return b}},a.resolveArgs=function(a,d){var e,f,g,h,i,j=a.slice(0),k=d?[d.id]:[];for(e=0,f=a.length;f>e;e++)if(g=a[e],"b"===g)j[e]="bang";else if("f"===g)j[e]="float";else if("s"===g)j[e]="symbol";else if("a"===g)j[e]="anything";else if("l"===g)j[e]="list";else if(h=b.exec(g))if(h[0]===g){if(i=parseInt(h[1],10),i>=k.length||0>i)throw new Error("$"+i+": argument number out of range");j[e]=k[i]}else{for(;h=c.exec(g);){if(i=parseInt(h[1],10),i>=k.length||0>i)throw new Error("$"+i+": argument number out of range");g=g.replace(h[0],k[i])}j[e]=g}return j};var b=/\$(\d+)/,c=/\$(\d+)/g;a.fillWithZeros=function(a,b){var c,d,b=void 0!==b?b:0;for(c=b,d=a.length;d>c;c++)a[c]=0;return a},a.newBuffer=function(b){return void 0===b&&(b=1),new a.arrayType(a.blockSize*b)},a.notImplemented=function(){throw new Error("Not implemented !")}}.call(this),function(a){var b=function(a,b){this._sampleRate=a,this._blockSize=b,this._channelCount=2};a.extend(b.prototype,{getSampleRate:function(){a.notImplemented()},stop:function(){a.notImplemented()},play:function(){a.notImplemented()},isPlaying:function(){a.notImplemented()}});var c=function(a,c){b.prototype.constructor.apply(this,arguments),null===d&&(d=new AudioContext),this._blockSize=c},d=null;a.extend(c.prototype,b.prototype,{getSampleRate:function(){return d.sampleRate},stop:function(){this._playing=!1,this._scriptNode.disconnect(),this._scriptNode=null},play:function(a){var b=this;this._scriptNode=d.createScriptProcessor(this._blockSize,1,this._channelCount),this._playing=!0,this._scriptNode.onaudioprocess=function(c){var d,e=c.outputBuffer,f=a();for(d=0;d<b._channelCount;d++)e.getChannelData(d).set(f[d])},this._scriptNode.connect(d.destination)},isPlaying:function(){return this._playing}}),a.AudioDriver=c}(this.Pd),function(a){var b=function(a,b){this.obj=a,this.id=b,this.init()};a.extend(b.prototype,{init:function(){},connect:function(){a.notImplemented()},disconnect:function(){a.notImplemented()},_genericConnect:function(a,b){-1===a.indexOf(b)&&(a.push(b),b.connect(this))},_genericDisconnect:function(a,b){var c=a.indexOf(b);-1!==c&&(a.splice(c,1),b.disconnect(this))}}),b.extend=a.chainExtend;var c=b.extend({init:function(){this.sources=[]},connect:function(a){this._genericConnect(this.sources,a),this.obj.emit("inletConnect")},disconnect:function(a){this._genericDisconnect(this.sources,a),this.obj.emit("inletDisconnect")},message:function(){this.obj.message.apply(this.obj,[this.id].concat(Array.prototype.slice.call(arguments)))},getBuffer:function(){a.notImplemented()},hasDspSources:function(){a.notImplemented()}}),d=b.extend({init:function(){this.sinks=[]},connect:function(a){this._genericConnect(this.sinks,a)},disconnect:function(a){this._genericDisconnect(this.sinks,a)},getBuffer:function(){a.notImplemented()},message:function(){a.notImplemented()}});a.inlet=c.extend({getBuffer:function(){throw new Error("No dsp buffer on a message inlet")},hasDspSources:function(){throw new Error("A message inlet cannot have dsp sources")}}),a["inlet~"]=c.extend({init:function(){c.prototype.init.apply(this,arguments),this.dspSources=[],this._buffer=a.newBuffer(),this._zerosBuffer=a.newBuffer(),a.fillWithZeros(this._zerosBuffer)},getBuffer:function(){var b=this.dspSources;if(b.length>1){var c,d,e,f,g,h=this._buffer;for(a.fillWithZeros(h),d=0,f=b.length;f>d;d++)for(c=b[d].getBuffer(),e=0,g=h.length;g>e;e++)h[e]+=c[e];return h}return 1===b.length?b[0].getBuffer():this._zerosBuffer},connect:function(b){b instanceof a["outlet~"]&&this.dspSources.push(b),c.prototype.connect.apply(this,arguments)},disconnect:function(a){var b=this.dspSources.indexOf(a);-1!==b&&this.dspSources.splice(b,1),c.prototype.disconnect.apply(this,arguments)},hasDspSources:function(){return this.dspSources.length>0}}),a.outlet=d.extend({getBuffer:function(){throw new Error("No dsp buffer on a message outlet")},message:function(){var a,b,c,d=this.sinks;for(b=0,c=d.length;c>b;b++)a=d[b],a.message.apply(a,arguments)}}),a["outlet~"]=d.extend({init:function(){d.prototype.init.apply(this,arguments),this._buffer=a.newBuffer()},getBuffer:function(){return this._buffer},message:function(){throw new Error("message received on dsp outlet, pas bon")}})}(this.Pd),function(a){a.Object=function(b,c){this.patch=b||null,this.id=null,this.frame=-1,this._args=c=c||[],this._guiData={},this.inlets=[],this.outlets=[];var d,e,f=this.outletTypes,g=this.inletTypes;for(d=0,e=f.length;e>d;d++)this.outlets[d]=new a[f[d]](this,d);for(d=0,e=g.length;e>d;d++)this.inlets[d]=new a[g[d]](this,d);this.resolveArgs&&(c=a.resolveArgs(c,b)),this.init.apply(this,c),"abstract"!==this.type&&(a.register(this),b&&b.addObject(this))},a.extend(a.Object.prototype,EventEmitter.prototype,a.UniqueIdsBase,{loadPriority:0,endPoint:!1,endPointPriority:0,outletTypes:[],inletTypes:[],type:"abstract",abbreviations:void 0,resolveArgs:!0,i:function(a){if(a<this.inlets.length)return this.inlets[a];throw new Error("invalid inlet "+a)},o:function(a){if(a<this.outlets.length)return this.outlets[a];throw new Error("invalid outlet "+a)},init:function(){},load:function(){},dspTick:function(){},message:function(){},assertIsNumber:function(b,c){if(!a.isNumber(b))throw new Error(c)},assertIsArray:function(b,c){if(!a.isArray(b))throw new Error(c)},assertIsString:function(b,c){if(!a.isString(b))throw new Error(c)},assertIsBang:function(a,b){if("bang"!==a)throw new Error(b)},dspTickNoOp:function(){},toDspTickNoOp:function(){this.dspTick=this.dspTickNoOp},dspTickZeros:function(){a.fillWithZeros(this.outlets[0].getBuffer())},toDspTickZeros:function(){this.dspTick=this.dspTickZeros},dspTickId:function(){var a,b,c=this.outlets[0].getBuffer(),d=this.inlets[0].getBuffer();for(a=0,b=c.length;b>a;a++)c[a]=d[a]},toDspTickId:function(){this.dspTick=this.dspTickId}}),a.Object.extend=a.chainExtend;var b={setName:function(a){var b="unvalid name "+a,c=this.name;if(this.assertIsString(a,b),!a)throw new Error(b);this.name=a,this.emit("change:name",c,a)}};a.NamedObject=a.Object.extend(b),a.UniquelyNamedObject=a.Object.extend(b)}(this.Pd),function(a){a.Patch=function(){a.register(this),this.sampleRate=a.sampleRate,this.blockSize=a.blockSize,this.channelCount=a.channelCount,this._graph={objects:[],endPoints:[]},this._scheduled={},this.audio=new a.AudioDriver(this.sampleRate,this.blockSize),this.output=[],this.frame=0},a.extend(a.Patch.prototype,EventEmitter.prototype,a.UniqueIdsBase,{send:function(a){this.emit.apply(this,["msg:"+a].concat(Array.prototype.slice.call(arguments,1)))},receive:function(a,b){this.on("msg:"+a,b)},getAbsTime:function(){return this.frameToTime(this.frame)},frameToTime:function(a){return a*this.blockSize/(this.sampleRate/1e3)},timeToFrame:function(a){return a/(this.blockSize/(this.sampleRate/1e3))},millisToSamp:function(a){return this.sampleRate*a/1e3},sampToMillis:function(a){return 1e3*a/this.sampleRate},timeout:function(a,b,c){return this._genericSchedule({callback:b,context:c,absTime:this.getAbsTime()+a,repeat:!1})},interval:function(a,b,c){return this._genericSchedule({callback:b,context:c,absTime:this.getAbsTime()+a,repeat:!0,time:a})},clear:function(a){var b,c,d,e;for(b in this._scheduled)for(c=this._scheduled[b],e=0;d=c[e];){if(d.id===a)return void c.splice(e,1);e++}},_genericSchedule:function(a,b){if(a.callback&&a.absTime){var c=Math.ceil(this.timeToFrame(a.absTime));return cbs=this._scheduled[c]=this._scheduled[c]||[],cbs.push(a),b!==!0?a.id=this._generateId():void 0}},generateFrame:function(){var a,b,c,d=this,e=this.getEndPoints(),f=this._scheduled[this.frame]||[];for(delete this._scheduled[this.frame],a=0;b=e[a];a++)d.tick(b);for(this.frame++,a=0;c=f[a];a++)c.repeat&&(c.absTime+=c.time,this._genericSchedule(c,!0)),c.callback.call(c.context);return this.output},tick:function(b){if(b.frame<this.frame){var c,d,e,f,g,h=b.inlets;for(b.frame=this.frame,d=0,f=h.length;f>d;d++)if(h[d]instanceof a["inlet~"])for(c=h[d].sources,e=0,g=c.length;g>e;e++)this.tick(c[e].obj);b.dspTick&&b.dspTick()}},play:function(){var a=this;this.isPlaying()?console.debug("Already started."):(console.debug("Starting audio."),this.sampleRate=this.audio.getSampleRate(),this.getAllObjects().sort(function(a,b){return b.loadPriority-a.loadPriority}).map(function(a){a.load()},this),this.audio.play(function(){return a.generateFrame()}),this.frame=0,this.getAllObjects().map(function(a){a.frame=-1}))},stop:function(){this.isPlaying()?(console.debug("Stopping audio."),this.audio.stop()):console.debug("Already stopped.")},isPlaying:function(){return this.audio.isPlaying()},addObject:function(a){if(-1===this._graph.objects.indexOf(a)){var b=this._generateId();a.id=b,a.patch=this,this._graph.objects[b]=a,a.endPoint&&this._graph.endPoints.push(a),this.isPlaying()&&a.load(),console.debug("Added "+a.type+" to the graph at position "+b)}},removeObject:function(a){var b,c,d=this.getAllConnections(a),e=this._graph.endPoints.indexOf(a);for(b=0,c=d.length;c>b;b++)this.disconnect(d[b][0],d[b][1]);delete this._graph.objects[a.id],-1!==e&&this._graph.endPoints.splice(e,1)},getObject:function(a){return this._graph.objects[a]||null},getEndPoints:function(){return this._graph.endPoints.sort(function(a,b){return b.endPointPriority-a.endPointPriority})},connect:function(a,b){this._checkContainsObj(a.obj),this._checkContainsObj(b.obj),a.connect(b)},disconnect:function(a,b){this._checkContainsObj(a.obj),this._checkContainsObj(b.obj),a.disconnect(b)},getAllObjects:function(){var a,b,c=this._graph.objects,d=[];for(a=0,b=c.length;b>a;a++)c[a]&&d.push(c[a]);return d},getAllConnections:function(a){var b,c,d,e,f=[];if(void 0===a){var g=this.getAllObjects();for(c=0;c<g.length;c++)for(a=g[c],d=0;d<a.outlets.length;d++)for(b=a.o(d),e=0;e<b.sinks.length;e++)f.push([b,b.sinks[e]])}else{var h;for(d=0;d<a.outlets.length;d++)for(b=a.o(d),e=0;e<b.sinks.length;e++)f.push([b,b.sinks[e]]);for(d=0;d<a.inlets.length;d++)for(h=a.i(d),e=0;e<h.sources.length;e++)f.push([h.sources[e],h])}return f},_checkContainsObj:function(a){if(-1===this._graph.objects.indexOf(a))throw new Error("this object is not in the patch")}})}(this.Pd),function(a){a.objects={"null":{},cnv:{}},a.objects.text=a.Object.extend({load:function(a){this.text=a}}),a.objects.loadbang=a.Object.extend({outletTypes:["outlet"],loadPriority:-10,load:function(){this.outlets[0].message("bang")}}),a.objects.print=a.Object.extend({inletTypes:["inlet"],init:function(a){this.printName=a||"print"},message:function(){var a=Array.prototype.slice.call(arguments,1);console.log(this.printName+": "+a.join(" "))}}),a.objects.table=a.UniquelyNamedObject.extend({init:function(b,c){this.setName(b),this.size=c,this.data=new a.arrayType(c)}}),a.objects.delline=a.UniquelyNamedObject.extend({init:function(b,c){this.setName(b),this.size=c,this.data=new a.arrayType(c),this.pos=0},write:function(a){var b,c,d=this.size,e=this.pos;for(b=0,c=a.length;c>b;b++,e++)this.data[e%d]=a[b];this.pos=e,this.emit("written")},read:function(a,b){if(b=Math.round(b),b<this.pos-this.size)throw new Error("cannot read position "+b+", delay line too short");if(b+a.length>this.pos)throw new Error("cannot read ahead of current position");var c,d=0,e=this.size;if(0>b){for(c=a.length;c>d&&0>b;d++,b++)a[d]=0;if(d>=c)return}for(b%=e,c=a.length;c>d;d++,b++)a[d]=this.data[b%e]}}),a.objects.message=a.Object.extend({inletTypes:["inlet"],outletTypes:["outlet"],resolveArgs:!1,init:function(){this.setTransfer(Array.prototype.slice.call(arguments,0))},setTransfer:function(b){this.transfer=b,this.transferFunc=a.makeMsgTransfer(this.transfer)},message:function(a){if(0===a){var b,c=Array.prototype.slice.call(arguments,1);b=this.outlets[0],b.message.apply(b,this.transferFunc(c))}}});var b=a.Object.extend({inletTypes:["inlet","inlet"],outletTypes:["outlet"],init:function(a){this.setVal(a||0),this.lastResult=0},setVal:function(a){this.assertIsNumber(a,"invalid constant value "+a),this.val=a},message:function(a,b){0===a?("bang"!==b&&(this.assertIsNumber(b,"value must be a number"),this.lastResult=this.compute(b)),this.outlets[0].message(this.lastResult)):1===a&&this.setVal(b)},compute:function(){}});a.objects["+"]=b.extend({compute:function(a){return a+this.val}}),a.objects["-"]=b.extend({compute:function(a){return a-this.val}}),a.objects["*"]=b.extend({compute:function(a){return a*this.val}}),a.objects["/"]=b.extend({compute:function(a){return a/this.val}}),a.objects.mod=b.extend({abbreviations:["%"],compute:function(a){return a%this.val}}),a.objects["float"]=a.Object.extend({inletTypes:["inlet","inlet"],outletTypes:["outlet"],abbreviations:["f"],init:function(a){this.setVal(a||0)},setVal:function(a){this.assertIsNumber(a,"value must be a number"),this.val=a},message:function(a,b){0===a?("bang"!==b&&this.setVal(b),this.outlets[0].message(this.val)):1===a&&this.setVal(b)}}),a.objects.spigot=a.Object.extend({inletTypes:["inlet","inlet"],outletTypes:["outlet"],init:function(a){this.setPassing(a||0)},setPassing:function(a){this.assertIsNumber(a,"value must be a number"),this.passing=Boolean(a)},message:function(a,b){if(0===a){if(this.passing){var c=this.outlets[0],d=Array.prototype.slice.call(arguments,1);c.message.apply(c,d)}}else 1===a&&this.setPassing(b)}}),a.objects.trigger=a.Object.extend({inletTypes:["inlet"],outletTypes:[],abbreviations:["t"],init:function(){var b,c,d=Array.prototype.slice.call(arguments,0);for(0===d.length&&(d=["bang","bang"]),b=0,c=d.length;c>b;b++)this.outlets[b]=new a.outlet(this,b);this.filters=d},message:function(b,c){if(0===b){var d,e,f,g=Array.prototype.slice.call(arguments,1);for(d=this.filters.length-1;d>=0;d--)if(e=this.filters[d],f=this.outlets[d],"bang"===e)f.message("bang");else if("list"===e||"anything"===e)f.message.apply(f,g);else if("float"===e)c=g[0],f.message(a.isNumber(c)?c:0);else if("symbol"===e)if(c=g[0],"bang"===c)f.message("symbol");else if(a.isNumber(c))f.message("float");else{if(!a.isString(c))throw new Error("Got unexpected input "+c);f.message(c)}}}}),a.objects.pack=a.Object.extend({inletTypes:["inlet"],outletTypes:["outlet"],init:function(){var b,c=Array.prototype.slice.call(arguments,0),d=c.length;for(0===d&&(c=["float","float"],d=c.length),this.filters=c,this.memory=new Array(d),b=0;d>b;b++)this.inlets[b]=new a.inlet(this,b),this.memory[b]="float"===c[b]?0:"symbol"===c[b]?"symbol":c[b]},message:function(a,b){if(0===a){"bang"!==b&&(this.memory[a]=b);var c=this.outlets[0];c.message.apply(c,this.memory)}else this.memory[a]=b}}),a.objects.select=a.Object.extend({inletTypes:["inlet","inlet"],outletTypes:[],abbreviations:["sel"],init:function(){var b,c,d=Array.prototype.slice.call(arguments,0);for(0===d.length&&(d=[0]),b=0,c=d.length;c>b;b++)this.outlets[b]=new a.outlet(this,b);this.outlets[b]=new a.outlet(this,b),this.filters=d},message:function(a,b){if(0===a){var c;if(-1!==(c=this.filters.indexOf(b)))return void this.outlets[c].message("bang");this.outlets.slice(-1)[0].message(b)}else 1===a&&this.filters.length<=1&&(this.filters=[b])}}),a.objects.moses=a.Object.extend({inletTypes:["inlet","inlet"],outletTypes:["outlet","outlet"],init:function(a){this.setVal(a||0),this.lastResult=0},setVal:function(a){this.assertIsNumber(a,"invalid constant value "+a),this.val=a},message:function(a,b){0===a?(this.assertIsNumber(b,"value must be a number"),b<this.val?this.outlets[0].message(b):this.outlets[1].message(b)):1===a&&this.setVal(b)}}),a.objects.mtof=a.Object.extend({inletTypes:["inlet"],outletTypes:["outlet"],maxMidiNote:8.17579891564*Math.exp(86.585635235),message:function(a,b){if(0===a){this.assertIsNumber(b,"invalid midi note "+b);var c=0;c=-1500>=b?0:b>1499?this.maxMidiNote:8.17579891564*Math.exp(.057762265*b),this.outlets[0].message(c)}}}),a.objects.random=a.Object.extend({inletTypes:["inlet","inlet"],outletTypes:["outlet"],init:function(a){this.setMax(a||1)},setMax:function(a){this.assertIsNumber(a,"invalid maximum "+a),this.max=a},message:function(a,b){0===a?"bang"===b&&this.outputRandomInt():1===a&&this.setMax(b)},outputRandomInt:function(){this.outlets[0].message(Math.floor(Math.random()*this.max))}}),a.objects.metro=a.Object.extend({inletTypes:["inlet","inlet"],outletTypes:["outlet"],init:function(a){this.setRate(a||0),this.toDspTickNoOp(),this._intervalId=null,this._metroTick=this._metroTickNormal},setRate:function(a){this.assertIsNumber(a,"invalid rate "+a),this.rate=a},message:function(a,b){0===a?"bang"===b?this._restartMetroTick():"stop"===b?this._stopMetroTick():(this.assertIsNumber(b,"invalid msg "+b),0===b?this._stopMetroTick():this._restartMetroTick()):1===a&&(this.setRate(b),this._metroTick=this._metroTickRateChange)},_startMetroTick:function(){this._metroTick(),null===this._intervalId&&(this._intervalId=this.patch.interval(this.rate,function(){this._metroTick()},this))},_stopMetroTick:function(){null!==this._intervalId&&(this.patch.clear(this._intervalId),this._intervalId=null)},_restartMetroTick:function(){this._stopMetroTick(),this._startMetroTick()},_metroTickNormal:function(){this.outlets[0].message("bang")},_metroTickRateChange:function(){this._metroTick=this._metroTickNormal,this._restartMetroTick()}}),a.objects.delay=a.Object.extend({inletTypes:["inlet","inlet"],outletTypes:["outlet"],abbreviations:["del"],init:function(a){this.setDelay(a||0),this.toDspTickNoOp(),this._timeoutId=null},setDelay:function(a){this.assertIsNumber(a,"invalid delay "+a),this.delay=a},message:function(a,b){0===a?"bang"===b?(this._stopDelay(),this._startDelay()):"stop"===b?this._stopDelay():(this.setDelay(b),this._stopDelay(),this._startDelay()):1===a&&this.setDelay(b)},_startDelay:function(){null===this._timeoutId&&(this._timeoutId=this.patch.timeout(this.delay,this._delayReached,this))},_stopDelay:function(){null!==this._timeoutId&&(this.patch.clear(this._timeoutId),this._timeoutId=null)},_delayReached:function(){this.outlets[0].message("bang")}}),a.objects.timer=a.Object.extend({inletTypes:["inlet","inlet"],outletTypes:["outlet"],init:function(){this.refFrame=0},message:function(a,b){if(0===a)this.assertIsBang(b,"unvalid message : "+b),this.refFrame=this.patch.frame;else if(1===a){var c=this.patch;this.assertIsBang(b,"unvalid message : "+b),this.outlets[0].message((c.frame-this.refFrame)*c.blockSize*1e3/c.sampleRate)}}}),a.objects.receive=a.NamedObject.extend({inletTypes:[],outletTypes:["outlet"],abbreviations:["r"],init:function(a){var b=this._messageHandler();this.on("change:name",function(a,c){var d=this.patch;d&&(a&&d.removeListener("msg:"+a,b),d.on("msg:"+c,b))}),this.setName(a)},_messageHandler:function(){var a=this;return function(){var b=a.outlets[0];b.message.apply(b,arguments)}}}),a.objects.send=a.NamedObject.extend({inletTypes:["inlet"],outletTypes:[],abbreviations:["s"],init:function(a){this.setName(a)},message:function(a){if(0===a){var b=this.patch,c=Array.prototype.slice.call(arguments,1);b.send.apply(b,[this.name].concat(c))}}}),a.objects["list split"]=a.Object.extend({inletTypes:["inlet","inlet"],outletTypes:["outlet","outlet","outlet"],init:function(a){this.setSplitInd(a||0)},setSplitInd:function(a){this.assertIsNumber(a,"split point must be a number"),this.splitInd=a},message:function(a,b){if(0===a){var c=Array.prototype.slice.call(arguments,1);if(this.splitInd>c.length)this.outlets[2].message("bang");else{var d;this.splitInd===c.length?this.outlets[1].message("bang"):(d=this.outlets[1],d.message.apply(d,c.slice(this.splitInd,c.length))),0===this.splitInd?this.outlets[0].message("bang"):(d=this.outlets[0],d.message.apply(d,c.slice(0,this.splitInd)))}}else 1===a&&this.setSplitInd(b)}}),a.objects["osc~"]=a.Object.extend({inletTypes:["inlet~","inlet"],outletTypes:["outlet~"],init:function(a){this.setFreq(a||0),this.phase=0,this.dspTick=this.dspTickConstFreq,this.on("inletConnect",this._onInletConnect),this.on("inletDisconnect",this._onInletDisconnect)},load:function(){this.setFreq(this.freq),this.J=2*Math.PI/this.patch.sampleRate},setFreq:function(a){this.assertIsNumber(a,"frequency must be a number"),this.freq=a,this.patch&&(this.K=2*Math.PI*this.freq/this.patch.sampleRate)},dspTickVariableFreq:function(){var a,b,c=this.inlets[0].getBuffer(),d=this.outlets[0].getBuffer(),e=this.J,f=this.phase;for(a=0,b=d.length;b>a;a++)f+=e*c[a],d[a]=Math.cos(f);this.phase=f},dspTickConstFreq:function(){var a,b,c=this.outlets[0].getBuffer(),d=this.K,e=this.phase;for(a=0,b=c.length;b>a;a++)e+=d,c[a]=Math.cos(e);
this.phase=e},message:function(a,b){0===a?this.setFreq(b):1===a&&"bang"===b&&(this.phase=0)},_onInletConnect:function(){this.inlets[0].hasDspSources()&&(this.dspTick=this.dspTickVariableFreq)},_onInletDisconnect:function(){this.inlets[0].hasDspSources()||(this.dspTick=this.dspTickConstFreq)}}),a.objects["phasor~"]=a.Object.extend({inletTypes:["inlet~","inlet"],outletTypes:["outlet~"],init:function(a){this.setFreq(a||0),this.dspTick=this.dspTickConstFreq,this.phase=0,this.on("inletConnect",this._onInletConnect),this.on("inletDisconnect",this._onInletDisconnect)},load:function(){this.setFreq(this.freq),this.J=1/this.patch.sampleRate},setFreq:function(a){this.assertIsNumber(a,"frequency must be a number"),this.freq=a,this.patch&&(this.K=this.freq/this.patch.sampleRate)},dspTickVariableFreq:function(){var a,b,c=this.inlets[0].getBuffer(),d=this.outlets[0].getBuffer(),e=this.J,f=this.phase;for(a=0,b=d.length;b>a;a++)f=(f+e*c[a])%1,d[a]=f;this.phase=f},dspTickConstFreq:function(){var a,b,c=this.outlets[0].getBuffer(),d=this.K,e=this.phase;for(a=0,b=c.length;b>a;a++,e++)e=(e+d)%1,c[a]=e;this.phase=e},message:function(a,b){0===a?this.setFreq(b):1===a&&"bang"===b&&(this.phase=0)},_onInletConnect:function(){this.inlets[0].hasDspSources()&&(this.dspTick=this.dspTickVariableFreq)},_onInletDisconnect:function(){this.inlets[0].hasDspSources()||(this.dspTick=this.dspTickConstFreq)}}),a.objects["noise~"]=a.Object.extend({outletTypes:["outlet~"],dspTick:function(){{var a,b,c=this.outlets[0].getBuffer();this.J}for(a=0,b=c.length;b>a;a++)c[a]=2*Math.random()-1}}),a.objects["dac~"]=a.Object.extend({endPoint:!0,inletTypes:["inlet~","inlet~"],dspTick:function(){this.patch.output=[this.inlets[0].getBuffer(),this.inlets[1].getBuffer()]}}),a.objects["line~"]=a.Object.extend({inletTypes:["inlet"],outletTypes:["outlet~"],init:function(){this.y0=0,this.y1=0,this.n=0,this.nMax=0,this.toDspConst(this.y0)},dspTickConst:function(){var a,b,c=this.outlets[0].getBuffer(),d=this.y0;for(a=0,b=c.length;b>a;a++)c[a]=d},dspTickLine:function(){var a,b,c=this.outlets[0].getBuffer(),d=c.length,e=this.slope;for(a=0;d>a;a++,this.n++){if(this.n>=this.nMax){for(b=a;d>b;b++)c[b]=this.y1;this.toDspConst(this.y1),this.emit("end");break}c[a]=this.n*e+this.y0}},message:function(a,b,c){0===a&&(this.assertIsNumber(b,"invalid value "+b),void 0!==c?(this.assertIsNumber(c,"invalid duration "+c),this.toDspLine(b,c)):this.toDspConst(b))},toDspConst:function(a){this.y0=a,this.dspTick=this.dspTickConst},toDspLine:function(a,b){this.y1=a,this.n=0,this.nMax=b*this.patch.sampleRate/1e3,this.slope=(this.y1-this.y0)/this.nMax,this.dspTick=this.dspTickLine}}),a.objects["lop~"]=a.Object.extend({inletTypes:["inlet~","inlet"],outletTypes:["outlet~"],init:function(a){this.ym1=0,this.setCutOffFreq(a||0),this.dspTick=this.dspTickZeros,this.on("inletConnect",this._onInletConnect),this.on("inletDisconnect",this._onInletDisconnect)},load:function(){this.setCutOffFreq(this.cutOffFreq)},setCutOffFreq:function(a){this.assertIsNumber(a,"invalid cut-off frequency "+a),this.cutOffFreq=a,a=Math.max(0,a),this.coef=2*a*Math.PI/this.patch.sampleRate,this.coef=Math.max(0,this.coef),this.coef=Math.min(1,this.coef)},dspTickFiltering:function(){var a,b,c=this.inlets[0].getBuffer(),d=this.outlets[0].getBuffer(),e=this.coef;for(d[0]=this.ym1+e*(c[0]-this.ym1),a=1,b=d.length;b>a;a++)d[a]=d[a-1]+e*(c[a]-d[a-1]);this.ym1=d[b-1]},message:function(a,b){0===a?"clear"===b&&(this.ym1=0):1===a&&this.setCutOffFreq(b)},_onInletConnect:function(){this.inlets[0].hasDspSources()&&(this.dspTick=this.dspTickFiltering)},_onInletDisconnect:function(){this.inlets[0].hasDspSources()||(this.dspTick=this.dspTickZeros)}}),a.objects["hip~"]=a.Object.extend({inletTypes:["inlet~","inlet"],outletTypes:["outlet~"],init:function(a){this.xm1=0,this.ym1=0,this.setCutOffFreq(a||0),this.dspTick=this.dspTickZeros,this.on("inletConnect",this._onInletConnect),this.on("inletDisconnect",this._onInletDisconnect)},load:function(){this.setCutOffFreq(this.cutOffFreq)},setCutOffFreq:function(a){this.assertIsNumber(a,"invalid cut-off frequency "+a),this.cutOffFreq=a,a=Math.max(0,a),this.coef=1-2*a*Math.PI/this.patch.sampleRate,this.coef=Math.max(0,this.coef),this.coef=Math.min(1,this.coef)},dspTickFiltering:function(){var a,b,c=this.inlets[0].getBuffer(),d=this.outlets[0].getBuffer(),e=this.coef;for(d[0]=e*(this.ym1+c[0]-this.xm1),a=1,b=d.length;b>a;a++)d[a]=e*(d[a-1]+c[a]-c[a-1]);this.ym1=d[b-1],this.xm1=c[b-1]},message:function(a,b){0===a?"clear"===b&&(this.ym1=0,this.xm1=0):1===a&&this.setCutOffFreq(b)},_onInletConnect:function(){this.inlets[0].hasDspSources()&&(this.dspTick=this.dspTickFiltering)},_onInletDisconnect:function(){this.inlets[0].hasDspSources()||(this.dspTick=this.dspTickZeros)}});var c=a.Object.extend({setDellineName:function(b){var c=this.dellineName;if(this.dellineName=b,this.patch){var d=a.getUniquelyNamedObject("delline",b);if(!d)throw new Error("delay line "+b+" doesn't exist");this.delline=d}this.emit("change:dellineName",c,b)},load:function(){this.setDellineName(this.dellineName)}});a.objects["delwrite~"]=c.extend({inletTypes:["inlet~"],endPoint:!0,endPointPriority:10,init:function(b,c){this.dellineName=b,this.dellineSize=c,this.delline=null,this.dspTick=this.dspTickZeros,a.getUniquelyNamedObject("delline",b)?console.warning("delay line "+b+" already exists."):new a.objects.delline(null,[b,this.patch.millisToSamp(c)]),this.on("inletConnect",this._onInletConnect),this.on("inletDisconnect",this._onInletDisconnect)},dspTickWriting:function(){this.delline.write(this.inlets[0].getBuffer())},dspTickZeros:function(){this.delline.write(a.fillWithZeros(a.newBuffer()))},_onInletConnect:function(){this.inlets[0].hasDspSources()&&(this.dspTick=this.dspTickWriting)},_onInletDisconnect:function(){this.inlets[0].hasDspSources()||(this.dspTick=this.dspTickZeros)}}),a.objects["delread~"]=c.extend({inletTypes:["inlet"],outletTypes:["outlet~"],init:function(a,b){this.dellineName=a,this.delline=null,this.setDelay(b||0),this.on("change:dellineName",function(){this.setDelay(this.delay)})},dspTick:function(){var a=this.outlets[0].getBuffer();this.delline.read(a,this.delline.pos-this.delaySamp-a.length)},setDelay:function(a){this.assertIsNumber(a,"invalid delay value "+a),this.delay=a,this.delline&&(this.delay=Math.min(this.patch.sampToMillis(this.delline.size),this.delay),this.delay=Math.max(0,this.delay)),this.delaySamp=this.patch.millisToSamp(this.delay)},message:function(a,b){0===a&&this.setDelay(b)}}),a.objects["clip~"]=a.Object.extend({inletTypes:["inlet~","inlet","inlet"],outletTypes:["outlet~"],init:function(a,b){a=a||0,b=b||0,this.setLowVal(a),this.setHighVal(b)},dspTick:function(){var a,b,c=this.outlets[0].getBuffer(),d=this.inlets[0].getBuffer();for(a=0,b=d.length;b>a;a++)c[a]=Math.max(Math.min(d[a],this.highVal),this.lowVal)},setLowVal:function(a){this.assertIsNumber(a,"invalid low value "+a),this.lowVal=a},setHighVal:function(a){if(this.assertIsNumber(a,"invalid high value "+a),a<this.lowVal)throw new Error("high value cannot be less than low value");this.highVal=a},message:function(a,b){1===a?this.setLowVal(b):2===a&&this.setHighVal(b)}}),a.objects["sig~"]=a.Object.extend({outletTypes:["outlet~"],inletTypes:["inlet"],init:function(a){this.setVal(a||0)},setVal:function(a){this.assertIsNumber(a,"invalid value "+a),this.val=a},message:function(a,b){0===a&&this.setVal(b)},dspTick:function(){var a,b,c=this.outlets[0].getBuffer();for(a=0,b=c.length;b>a;a++)c[a]=this.val}});var d=a.Object.extend({inletTypes:["inlet~","inlet~"],outletTypes:["outlet~"],init:function(a){this.setVal(a||0),this.dspTick=this.dspTickConstant,this.on("inletConnect",this._onInletConnect),this.on("inletDisconnect",this._onInletDisconnect)},setVal:function(a){this.assertIsNumber(a,"invalid constant value "+a),this.val=a},message:function(a,b){1===a&&this.setVal(b)},dspTickVariable:a.notImplemented,dspTickConstant:a.notImplemented,_onInletConnect:function(){this.inlets[1].hasDspSources()&&(this.dspTick=this.dspTickVariable)},_onInletDisconnect:function(){this.inlets[1].hasDspSources()||(this.dspTick=this.dspTickConstant)}});a.objects["*~"]=d.extend({dspTickVariable:function(){var a,b,c=this.inlets[0].getBuffer(),d=this.inlets[1].getBuffer(),e=this.outlets[0].getBuffer();for(a=0,b=e.length;b>a;a++)e[a]=c[a]*d[a]},dspTickConstant:function(){var a,b,c=this.inlets[0].getBuffer(),d=this.outlets[0].getBuffer(),e=this.val;for(a=0,b=d.length;b>a;a++)d[a]=c[a]*e}}),a.objects["/~"]=d.extend({dspTickVariable:function(){var a,b,c,d=this.inlets[0].getBuffer(),e=this.inlets[1].getBuffer(),f=this.outlets[0].getBuffer();for(b=0,c=f.length;c>b;b++)a=e[b],f[b]=a?d[b]/a:0},dspTickConstant:function(){var a,b,c=this.inlets[0].getBuffer(),d=this.outlets[0].getBuffer(),e=this.val;for(a=0,b=d.length;b>a;a++)d[a]=e?c[a]/e:0}}),a.objects["+~"]=d.extend({dspTickVariable:function(){var a,b,c=this.inlets[0].getBuffer(),d=this.inlets[1].getBuffer(),e=this.outlets[0].getBuffer();for(a=0,b=e.length;b>a;a++)e[a]=c[a]+d[a]},dspTickConstant:function(){var a,b,c=this.inlets[0].getBuffer(),d=this.outlets[0].getBuffer(),e=this.val;for(a=0,b=d.length;b>a;a++)d[a]=c[a]+e}}),a.objects["-~"]=d.extend({dspTickVariable:function(){var a,b,c=this.inlets[0].getBuffer(),d=this.inlets[1].getBuffer(),e=this.outlets[0].getBuffer();for(a=0,b=e.length;b>a;a++)e[a]=c[a]-d[a]},dspTickConstant:function(){var a,b,c=this.inlets[0].getBuffer(),d=this.outlets[0].getBuffer(),e=this.val;for(a=0,b=d.length;b>a;a++)d[a]=c[a]-e}});var e=a.Object.extend({init:function(a){this.tableName=a,this.table=null},load:function(){this.setTableName(this.tableName)},setTableName:function(b){var c=this.tableName;if(this.tableName=b,this.patch){var d=a.getUniquelyNamedObject("table",b);if(!d)throw new Error("table with name "+b+" doesn't exist");this.table=d}this.emit("change:tableName",c,b)}});a.objects["tabread~"]=e.extend({inletTypes:["inlet~"],outletTypes:["outlet~"],init:function(a){e.prototype.init.call(this,a),this.toDspTickZeros(),this.on("change:tableName",function(){this.dspTick=this.dspTickReading})},dspTickReading:function(){var a,b,c,d=this.outlets[0].getBuffer(),e=this.inlets[0].getBuffer(),f=this.table.size-1,g=this.table.data;for(b=0,c=d.length;c>b;b++)a=Math.floor(e[b]),d[b]=g[a>=0?a>f?f:a:0]},message:function(a,b,c){0===a&&"set"===b&&this.setTableName(c)}}),a.objects["tabread4~"]=e.extend({inletTypes:["inlet~"],outletTypes:["outlet~"],init:function(a){e.prototype.init.call(this,a),this.toDspTickZeros(),this.on("change:tableName",function(){this.dspTick=this.dspTickReading})},dspTickReading:function(){var a,b,c,d,e,f,g,h=this.outlets[0].getBuffer(),i=this.inlets[0].getBuffer(),j=this.table.size-1,k=this.table.data;for(f=0,g=h.length;g>f;f++)a=i[f],b=Math.floor(a),c=Math.ceil(a),b=b>=0?b>j?j:b:0,c=c>=0?c>j?j:c:0,b===c?h[f]=k[b]:(d=k[b],e=k[c],h[f]=d+(a-b)*(e-d))},message:function(a,b,c){0===a&&"set"===b&&this.setTableName(c)}}),a.objects["tabplay~"]=e.extend({inletTypes:["inlet"],outletTypes:["outlet~"],init:function(a){e.prototype.init.call(this,a),this.pos=0,this.posMax=0,this.toDspTickZeros()},dspTickReading:function(){var b,c=this.outlets[0].getBuffer(),d=Math.min(c.length,this.posMax-this.pos);for(b=0;d>b;b++,this.pos++)c[b]=this.table.data[this.pos];this.pos===this.posMax&&(a.fillWithZeros(c,b),this.toDspTickZeros(),this.emit("end"))},message:function(a,b,c){0===a&&("set"===b?(this.setTableName(c),this.toDspTickZeros()):"bang"===b?this.toDspTickReading(0):void 0!==b&&(this.assertIsNumber(b,"not a valid start position "+b),void 0!==c?(this.assertIsNumber(c,"not a valid sample number "+c),this.toDspTickReading(b,c)):this.toDspTickReading(b)))},toDspTickReading:function(a,b){a>=this.table.size-1||(b=b||this.table.size-a,this.pos=a,this.posMax=Math.min(a+b,this.table.size),this.dspTick=this.dspTickReading)}}),a.objects["tabwrite~"]=e.extend({inletTypes:["inlet~"],endPoint:!0,init:function(a){e.prototype.init.call(this,a),this.pos=0,this.toDspTickNoOp()},dspTickWriting:function(){var a,b=this.inlets[0].getBuffer(),c=Math.min(b.length,this.table.size-this.pos);for(a=0;c>a;a++,this.pos++)this.table.data[this.pos]=b[a];this.pos===this.table.size&&(this.toDspTickNoOp(),this.emit("end"))},message:function(a,b,c){if(0===a)if("bang"===b)this.toDspTickWriting(0);else if("stop"===b)this.toDspTickNoOp();else if("set"===b)this.setTableName(c),this.toDspTickNoOp();else if("start"===b){var d=0;void 0!==c&&(this.assertIsNumber(c,"invalid start position "+c),d=Math.floor(c)),this.toDspTickWriting(d)}},toDspTickWriting:function(a){this.dspTick=this.dspTickWriting,this.pos=a}});var f,g,h,i,j;for(h in a.objects)if(g=a.objects[h],(f=g.prototype)&&(f.type=h,i=f.abbreviations))for(j=0;j<i.length;j++)a.objects[i[j]]=g}(this.Pd),function(a){var b=/ |\r\n?|\n/,c=/\\(\$\d+)/g;a.compat={},a.compat.parseArg=function(b){var d=a.compat.parseFloat(b);if(a.isNumber(d))return d;if(a.isString(b)){for(var e,b=b.substr(0);e=c.exec(b);)b=b.replace(e[0],e[1]);return b}throw new Error("couldn't parse arg "+b)},a.compat.parseFloat=function(b){return a.isNumber(b)?b:a.isString(b)?parseFloat(b):0/0},a.compat.parseArgs=function(c){if(a.isNumber(c))return[c];var d,e,f=a.isString(c)?c.split(b):c,g=[];for(d=0,e=f.length;e>d;d++)""!==(arg=f[d])&&g.push(a.compat.parseArg(arg));return g};var d=/(#((.|\r|\n)*?)[^\\\\])\r{0,1}\n{0,1};\r{0,1}(\n|$)/gi;a.compat.parse=function(c){var e,f=null,g=new a.Patch;for(d.lastIndex=0;e=d.exec(c);){var h=e[1].split(b),i=h[0];if("#X"===i){var j=h[1];if("obj"===j||"msg"===j||"text"===j){var k,l,m,n=parseInt(h[2],10),o=parseInt(h[3],10);if("msg"===j?(k="message",l=h.slice(4)):"text"===j?(k="text",l=[h.slice(4).join(" ")]):"list"===h[4]?(k=h[4]+" "+h[5],l=h.slice(6)):(k=h[4],l=h.slice(5)),!a.objects.hasOwnProperty(k))throw new Error('unknown object "'+k+'"');m=new a.objects[k](g,a.compat.parseArgs(l)),m._guiData.x=n,m._guiData.y=o}else if("array"===j){var p=h[2],q=parseFloat(h[3]),m=new a.objects.table(g,[p,q]);f=m}else if("restore"===j)f=null;else if("connect"===j){var r=g.getObject(parseInt(h[2],10)),s=g.getObject(parseInt(h[4],10));g.connect(r.o(parseInt(h[3],10)),s.i(parseInt(h[5],10)))}else if("coords"!==j)throw new Error('unknown element "'+j+'"')}else if("#A"===i){var t,u,v,w=parseFloat(h[1]);if(f)for(t=2,u=h.length;u>t;t++,w++)v=parseFloat(h[t]),a.isNumber(v)&&(f.data[w]=v);else console.error("got table data outside of a table.")}else if("#N"!==i)throw new Error('unknown chunk "'+i+'"')}return console.debug("Graph:"),console.debug(g),g}}(this.Pd);